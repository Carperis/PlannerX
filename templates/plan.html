{% extends 'base.html' %}

{% block head %}
<title>BU PlannerX - Plan</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
    function shownext() {
        $.ajax({
            url: "/plan/showschedule/{{plan.id}}/-2",
            type: "POST",
            success: function (data) {
                $("#img").prop('src', '/static/Users/{{user.id}}/{{plan.id}}/schedule.png?' + new Date().getTime());
                $("#num").prop('value', data.num);
                {%if (plan.planNum == -1)%}
                location.reload();
                {% endif %}
            }
        });
    }
    function showprevious() {
        $.ajax({
            url: "/plan/showschedule/{{plan.id}}/-4",
            type: "POST",
            success: function (data) {
                $("#img").prop('src', '/static/Users/{{user.id}}/{{plan.id}}/schedule.png?' + new Date().getTime());
                $("#num").prop('value', data.num);
            }
        });
    }
    function goto() {
        var n = $("#num").val();
        $.ajax({
            url: "/plan/showschedule/{{plan.id}}/" + n,
            type: "POST",
            success: function (data) {
                $("#img").prop('src', '/static/Users/{{user.id}}/{{plan.id}}/schedule.png?' + new Date().getTime());
                $("#num").prop('value', data.num);
            }
        });
    }
    $(document).ready(function () {
        $('#num').keypress(function (e) {
            if (e.keyCode == 13) {
                if (isNaN($("#num").val()) || $('#num').val().length === 0) {
                    $("#num").prop('value', "1");
                }
                $("#goto").click();
            }
        });
    });

</script>
{% endblock %}

{% block body %}
<div class="container-fluid bg-gray-900" style="padding-top: 25px; padding-bottom: 40px">
    <div class="row" style="display: flex; align-items: center; justify-content: center;">
        <div class="col-md-12">
            {% if msg != [] %}
            <div class="alert alert-success alert-dismissable">

                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                    <i class="fa-solid fa-circle-xmark fa-xs"></i>
                </button>
                {% for message in msg%}
                <div class="alert mainfont-bold" style="margin-bottom: 0; padding-top: 0; padding-bottom: 0; ">{{
                    message }}</div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="row mainfont-bold text-white">
                <div class="col-md-8">
                    <form role="form" action="/plan/{%if plan.id%}{{plan.id}}{%else%}0{%endif%}" method="POST">
                        <div class="form-group">
                            <i class="fa-solid fa-user fa-inverse"></i>
                            <label for="content">
                                Plan Name
                            </label>
                            <input type="text" name="planname" id="planname" placeholder="Plan Name"
                                value="{% if (not (request.form['planname'])) %}{% if plan %}{{ plan.planname }}{% endif %}{% else %}{{request.form['planname']}}{% endif %}"
                                class="mainfont-regular rounded-lg form-control bg-gray-800 text-gray-300">
                        </div>
                        <div class="form-group">
                            <i class="fa-solid fa-calendar-days fa-inverse"></i>
                            <label for="content">
                                Semester
                            </label>
                            <div style="display: flex;">
                                <select class="bg-gray-800 text-gray-300 w-full p-2 rounded-lg mainfont-regular"
                                    name="years" id="" style="margin-right: 5px;">
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                </select>
                                <select class="bg-gray-800 text-gray-300 w-full p-2 rounded-lg mainfont-regular"
                                    name="term" id="" style="margin-left: 5px;">
                                    <option value="SPRG" {% if (not (request.form['term'])) %}{%if plan%}{% if
                                        (plan.semester.split("-")[1]=="SPRG" ) %}selected="selected" {% endif %}{% endif
                                        %}{% else %}{% if ( request.form['term']=="SPRG" ) %}selected="selected" {%
                                        endif %}{% endif %}>Spring
                                    </option>
                                    <option value="FALL" {% if (not (request.form['term'])) %}{%if plan%}{% if
                                        (plan.semester.split("-")[1]=="FALL" ) %}selected="selected" {% endif %}{% endif
                                        %}{% else %}{% if ( request.form['term']=="FALL" ) %}selected="selected" {%
                                        endif %}{% endif %}>Fall
                                    </option>
                                    <option value="SUMM_1" {% if (not (request.form['term'])) %}{%if plan%}{% if
                                        (plan.semester.split("-")[1]=="SUMM_1" ) %}selected="selected" {% endif %}{%
                                        endif %}{% else %}{% if ( request.form['term']=="SUMM_1" ) %}selected="selected"
                                        {% endif %}{% endif %}>Summer 1
                                    </option>
                                    <option value="SUMM_2" {% if (not (request.form['term'])) %}{%if plan%}{% if
                                        (plan.semester.split("-")[1]=="SUMM_2" ) %}selected="selected" {% endif %}{%
                                        endif %}{% else %}{% if ( request.form['term']=="SUMM_2" ) %}selected="selected"
                                        {% endif %}{% endif %}>Summer 2</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <i class="fa-solid fa-book-open-reader fa-inverse"></i>
                            <label for="content">
                                Courses
                            </label>
                            <input type="text" name="courses" id="courses"
                                placeholder="CAS XX 101,ENG XX 101,QST XX 101"
                                value="{% if (not (request.form['courses'])) %}{% if plan %}{{ plan.courses }}{% endif %}{% else %}{{request.form['courses']}}{% endif %}"
                                class="mainfont-regular rounded-lg form-control bg-gray-800 text-gray-300">
                        </div>

                        <div class="form-group">
                            <i class="fa-solid fa-chalkboard-user fa-inverse"></i>
                            <label for="content">
                                Average Professors Score
                            </label>
                            <input type="number" step="0.01" name="AvgScore" id="AvgScore"
                                placeholder="Rate Your Professors!"
                                value="{% if (not (request.form['AvgScore'])) %}{% if plan %}{{ plan.AvgScore }}{% endif %}{% else %}{{request.form['AvgScore']}}{% endif %}"
                                class="mainfont-regular rounded-lg form-control bg-gray-800 text-gray-300">
                        </div>

                        <div class="form-group">
                            <i class="fa-solid fa-person-running fa-inverse fa-lg"></i>
                            <label for="content">
                                Prefer Starting Time
                            </label>
                            <input type="time" name="EarlyTime" id="EarlyTime"
                                value="{% if (not (request.form['EarlyTime'])) %}{% if plan %}{{ plan.EarlyTime }}{% endif %}{% else %}{{request.form['EarlyTime']}}{% endif %}"
                                class="mainfont-regular rounded-lg form-control bg-gray-800 text-gray-300">
                        </div>

                        <div class="form-group">
                            <i class="fa-solid fa-person-running fa-inverse fa-flip-horizontal fa-lg"></i>
                            <label for="content">
                                Prefer Ending Time
                            </label>
                            <input type="time" name="LateTime" id="LateTime"
                                value="{% if (not (request.form['LateTime'])) %}{% if plan %}{{ plan.LateTime }}{% endif %}{% else %}{{request.form['LateTime']}}{% endif %}"
                                class="mainfont-regular rounded-lg form-control bg-gray-800 text-gray-300">
                        </div>

                        <button id="btn" type="submit"
                            class="ml-auto mt-2 bg-blue-500 py-2 px-6 text-white mainfont-bold text-base rounded-lg">
                            Submit / Update
                        </button>
                    </form>
                </div>
                <div class="col-md-4">
                    <br>
                    {% if(plan) %}
                    <h2>Hi {{ user.username }}:</h2><br>
                    <div>
                        <h3>Your {{ plan.semester }} classes:</h3>
                        <ol>
                            <div class="mainfont-regular">
                                {% for cls in plan.courses.split(",") %}
                                <li class="list-item">
                                    {{cls}}
                                </li>
                                {% endfor %}
                            </div>
                        </ol><br>
                        <h3>Your prefer avergae score:</h3>
                        <div class="mainfont-regular">{{ plan.AvgScore }}</div>
                        <h3>Your prefer starting time:</h3>
                        <div class="mainfont-regular">{{ plan.EarlyTime }}</div>
                        <h3>Your prefer finishing time:</h3>
                        <div class="mainfont-regular">{{ plan.LateTime }}</div>
                    </div>
                    <br>
                    <button class="ml-auto mt-2 bg-blue-500 py-2 px-6 text-white mainfont-bold text-base rounded-lg"
                        onclick="window.location.href='/getplans/{{
                                    plan.id }}';" id="btn">
                        Get Plans
                    </button><br>
                    <button class="ml-auto mt-2 bg-blue-500 py-2 px-6 text-white mainfont-bold text-base rounded-lg"
                        onclick="window.location.href='/rankplans/{{
                                plan.id }}';" id="btn">
                        Rank Plans
                    </button><br>
                    <button class="ml-auto mt-2 bg-blue-500 py-2 px-6 text-white mainfont-bold text-base rounded-lg"
                        onclick="shownext()" id="btn">
                        Show Plans
                    </button><br>
                    <button class="ml-auto mt-2 bg-blue-500 py-2 px-6 text-white mainfont-bold text-base rounded-lg"
                        onclick="window.location.href='/deleteplan/{{
                                plan.id }}';" id="btn">
                        Delete
                    </button>
                    {% else %}
                    <h3>Hi {{user.username}}</h3>
                    <br>
                    <div class="mainfont-regular">
                        <p>Please fill out ALL columns for an optimized schedule!</p>
                        <br>
                        <p>Classes Input Template: <br>
                            CAS XX 101,ENG XX 101,QST XX 101
                        </p><br>
                        <p>*** Make sure there's no space after the comma! ***</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% if plan %}
            {% if (plan.planNum != -1) %}
            <div class="row"
                style="margin-bottom: 20px; margin-top: 50px; display: flex; align-items: center; justify-content: center;">
                <div class="row" style="width: 80%;">
                    <img src="/static/Users/{{user.id}}/{{plan.id}}/schedule.png" id="img"
                        style="width: 100%; height: 600;" />
                </div>
                <div class="row"
                    style="width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0px 15% 0px 15%;">
                    <button onclick=" showprevious()">
                        <i class="fa-solid fa-angle-left fa-inverse fa-2xl"></i>
                    </button>
                    <div class="mainfont-bold text-white"
                        style="display: flex; align-items: center; justify-content: center;">
                        <p style="margin: 10px">Plan</p>
                        <input type="number" min="0" name="num" id="num" value="{{plan.planNum+1}}"
                            class="mainfont-regular rounded-lg form-control bg-gray-800 text-gray-300 w-20">
                        <button onclick="goto()" style="margin: 0;" id="goto">
                            <i class="fa-solid fa-angles-right fa-inverse fa-xl" style="margin: 10px"></i>
                        </button>
                    </div>
                    <button onclick="shownext()">
                        <i class="fa-solid fa-angle-right fa-inverse fa-2xl"></i>
                    </button>
                </div>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>;
{% endblock %}